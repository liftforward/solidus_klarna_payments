<% param_prefix = "payment_source[#{payment_method.id}]" %>

<div class="klarna_credit_box" data-order-id="<%= @order.number %>" data-payment-method-id="<%= payment_method.id %>" data-preferred-payment-method="<%= payment_method.options[:payment_method] %>">

  <%= hidden_field_tag "#{param_prefix}[authorization_token]", "", {id: "klarna_authorization_token"} %>
  <div class="klarna_error general_error flash error"><%= Spree.t('klarna.general_error') %></div>
  <div class="klarna_error denied_error flash error"><%= Spree.t('klarna.denied_error') %></div>
  <div id="klarna_container"></div>
</div>

<script type="text/javascript" id="klarna-credit-lib-x">
/* <![CDATA[ */
KlarnaGateway.loadSdk(this, document, function() {
  jQuery(".klarna_credit_box").klarnaAuthorize();
});
 /* ]]> */
</script>
